@model StayEasePG.Models.InitialBookingModel
@{
    ViewBag.Title = "Select Duration";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>

    /* -------------------------------------------------------------------------- */
    /* THEME VARIABLES & BASE STYLES                                              */
    /* -------------------------------------------------------------------------- */
    :root {
        --color-dark-bg: #171a21;
        --color-card-bg: #1f242d;
        --color-accent-yellow: #ffce4c;
        --color-text-light: #ffffff;
        --color-text-muted: #9fa6b3;
        --color-border: #3d4554;
        --color-primary: #ffce4c; /* Using accent for primary action */
    }

    body {
        background-color: var(--color-dark-bg) !important;
        color: var(--color-text-light);
    }

    .page-wrapper {
        padding-top: 10px;
    }
    /* -------------------------------------------------------------------------- */
    /* BOOKING CONTAINER STYLING                                                  */
    /* -------------------------------------------------------------------------- */
    .booking-container {
        max-width: 700px;
        margin: 30px auto;
        padding: 35px;
        border: 1px solid var(--color-border);
        border-radius: 12px;
        background-color: var(--color-card-bg);
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }
    /* Header Info */
    .header-info h2 {
        color: var(--color-accent-yellow);
        font-weight: 700;
        margin: 0;
    }

    .header-info p {
        color: var(--color-text-muted) !important;
        font-size: 0.95rem;
        margin-bottom: 5px;
    }
    /* Section Headers */
    h3 {
        color: var(--color-accent-yellow);
        font-weight: 600;
        margin-top: 25px;
        margin-bottom: 5px;
    }

    hr {
        border-top: 1px solid var(--color-border);
        margin-bottom: 20px;
    }
    /* -------------------------------------------------------------------------- */
    /* FORM & INPUT STYLING                                                       */
    /* -------------------------------------------------------------------------- */
    .col-form-label {
        color: var(--color-text-light);
        font-weight: 500;
    }

    .form-control {
        background-color: #2c323c;
        color: var(--color-text-light);
        border: 1px solid var(--color-border);
        border-radius: 6px;
        padding: 10px;
    }

        .form-control:focus {
            background-color: #3d4554;
            border-color: var(--color-accent-yellow);
            box-shadow: 0 0 0 0.2rem rgba(255, 206, 76, 0.25);
        }

    .text-danger {
        color: #ef4444 !important;
        font-size: 0.85rem;
    }
    /* Date Input Specific */
    input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
        opacity: 0.7;
    }
    /* FIX 1: Ensure Select Dropdown text is visible */
    #bookingTypeSelect {
        color: var(--color-text-light); /* Default text color in the field */
    }

        #bookingTypeSelect option {
            background-color: #2c323c; /* Background for options list */
            color: var(--color-text-light); /* Text color for options list */
        }
            /* Ensure the "Select Duration" prompt is visible against the dark input background */
            #bookingTypeSelect option[value=""] {
                color: var(--color-text-muted);
            }
    /* -------------------------------------------------------------------------- */
    /* PRICE TABLE STYLING                                                        */
    /* -------------------------------------------------------------------------- */
    .price-table {
        margin-top: 15px;
        color: var(--color-text-light);
    }

        .price-table th {
            background-color: #2c323c;
            color: var(--color-accent-yellow);
            font-weight: 700;
            padding: 10px;
            border-bottom: 2px solid var(--color-accent-yellow);
        }

        .price-table td {
            padding: 10px;
            border-bottom: 1px solid var(--color-border);
            color: var(--color-text-light);
            font-weight: 500;
        }

            .price-table th:first-child, .price-table td:first-child {
                text-align: left;
            }

        .price-table th, .price-table td {
            text-align: right;
        }
        /* Total Row */
        .price-table tfoot .table-info th,
        .price-table tfoot .table-info td {
            background-color: #2c323c;
            font-size: 1.1em;
            font-weight: 700;
            padding: 15px 10px;
            /* FIX 2: Ensure the top border for the total row is a full line */
            border-top: 3px solid var(--color-accent-yellow) !important;
            border-bottom: none; /* Remove any potential bottom border */
        }

    .total-amount-display {
        font-size: 1.6em;
        font-weight: bold;
        color: #34d399; /* Green for the final total */
    }
    /* -------------------------------------------------------------------------- */
    /* BUTTON STYLING                                                             */
    /* -------------------------------------------------------------------------- */
    /* Back Button */
    .btn-secondary {
        background-color: transparent !important;
        border: 1px solid var(--color-border) !important;
        color: var(--color-text-light) !important;
        transition: background-color 0.2s, color 0.2s;
        border-radius: 8px;
        padding: 8px 15px;
    }

        .btn-secondary:hover {
            background-color: #3d4554 !important;
            color: var(--color-accent-yellow) !important;
        }
    /* Proceed Button */
    .btn-primary {
        background-color: var(--color-primary);
        border: 2px solid var(--color-primary);
        color: var(--color-dark-bg);
        font-weight: 700;
        border-radius: 8px;
        transition: background-color 0.2s, opacity 0.2s;
    }

        .btn-primary:hover:not(:disabled) {
            background-color: #ffde78;
            border-color: #ffde78;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
</style>
<div class="page-wrapper">
    <div class="booking-container">
        <div class="header-info">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:15px;">
                <h2>Book Room: @Model.RoomType</h2>
                <a href="@Url.Action("Details", "PGMaster", new { id = Model.PGID })" class="btn btn-secondary">
                    ← Back
                </a>
            </div>
            <p class="text-muted"><strong>@Model.PGName</strong> - @Model.Location</p>
            <p class="text-muted">Address: @Model.Address</p>
        </div>
        @using (Html.BeginForm("CalculateBooking", "PGMaster", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.PGID)
            @Html.HiddenFor(m => m.RoomID)
            @Html.HiddenFor(m => m.PGName)
            @Html.HiddenFor(m => m.Location)
            @Html.HiddenFor(m => m.Address)
            @Html.HiddenFor(m => m.RoomType)
            @Html.HiddenFor(m => m.PricePerDay)
            @Html.HiddenFor(m => m.PricePerWeek)
            @Html.HiddenFor(m => m.PricePerMonth)
            @Html.HiddenFor(m => m.Maintenance)
            @Html.HiddenFor(m => m.Advance)
            @Html.HiddenFor(m => m.Deposit)
            <h3>1. Select Booking Details</h3>
            <hr />
            <div class="form-group row mb-3">
                @Html.LabelFor(m => m.CheckInDate, new { @class = "col-sm-4 col-form-label" })
                <div class="col-sm-8">
                    @Html.TextBoxFor(m => m.CheckInDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                    @Html.ValidationMessageFor(m => m.CheckInDate, "", new { @class = "text-danger" })
                </div>
            </div>
            <div class="form-group row mb-3">
                @Html.LabelFor(m => m.SelectedBookingType, new { @class = "col-sm-4 col-form-label" })
                <div class="col-sm-8">
                    @Html.DropDownListFor(
                        m => m.SelectedBookingType,
                        new List<SelectListItem>
                        {
                            new SelectListItem { Value = "Day", Text = "Daily (₹" + Model.PricePerDay.ToString("N0") + ")" },
                            new SelectListItem { Value = "Week", Text = "Weekly (₹" + Model.PricePerWeek.ToString("N0") + ")" },
                            new SelectListItem { Value = "Month", Text = "Monthly (₹" + Model.PricePerMonth.ToString("N0") + ")" }
                        },
                        "--- Select Duration ---",
                        new { @class = "form-control", id = "bookingTypeSelect" }
                    )
                    @Html.ValidationMessageFor(m => m.SelectedBookingType, "", new { @class = "text-danger" })
                </div>
            </div>
            <h3>2. Price Breakdown</h3>
            <hr />
            <table class="table table-sm price-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Amount (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Base Rent (Selected Duration)</td>
                        <td id="basePriceDisplay">Select Duration Above</td>
                    </tr>
                    <tr>
                        <td>Advance Payment</td>
                        <td>@Model.Advance.ToString("N0")</td>
                    </tr>
                    <tr>
                        <td>Deposit</td>
                        <td>@Model.Deposit.ToString("N0")</td>
                    </tr>
                    <tr>
                        <td>Maintenance Fee</td>
                        <td>@Model.Maintenance.ToString("N0")</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="table-info">
                        <th>Total Amount Due Today</th>
                        <td class="total-amount-display" id="totalAmountDisplay">0</td>
                    </tr>
                </tfoot>
            </table>
            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%; margin-top: 20px;" id="proceedButton" disabled>
                Proceed to Payment
            </button>
        }
    </div>
</div>
<script>
   document.addEventListener('DOMContentLoaded', function () {
       const select = document.getElementById('bookingTypeSelect');
       const basePriceDisplay = document.getElementById('basePriceDisplay');
       const totalAmountDisplay = document.getElementById('totalAmountDisplay');
       const proceedButton = document.getElementById('proceedButton');
       // Prices from the model (using C# to inject JavaScript variables)
       const prices = {
           'Day': @Model.PricePerDay,
           'Week': @Model.PricePerWeek,
           'Month': @Model.PricePerMonth
       };
       const maintenance = @Model.Maintenance;
       const advance = @Model.Advance;
       const deposit = @Model.Deposit;
       function updatePrice() {
           const selectedType = select.value;
           let basePrice = prices[selectedType] || 0;
           if (selectedType && selectedType !== "--- Select Duration ---") {
               // Calculate Total: Base Price + Fixed Fees
               let total = basePrice + maintenance + advance + deposit;
               // Format numbers with Indian locale (using 'en-IN' for ₹)
               basePriceDisplay.textContent = basePrice.toLocaleString('en-IN');
               totalAmountDisplay.textContent = total.toLocaleString('en-IN');
               proceedButton.disabled = false;
           } else {
               basePriceDisplay.textContent = 'Select Duration Above';
               totalAmountDisplay.textContent = '0';
               proceedButton.disabled = true;
           }
           // This part ensures the field itself reflects the correct color after selection
           if (select.value === "") {
                select.style.color = 'var(--color-text-muted)'; // Less visible for prompt
           } else {
                select.style.color = 'var(--color-text-light)'; // White for selected value
           }
       }
       select.addEventListener('change', updatePrice);
       // Initial call to set the correct state and color
       updatePrice();
       const checkInDateInput = document.getElementById('@Html.IdFor(m => m.CheckInDate)');
       if (checkInDateInput) {
           checkInDateInput.setAttribute('min', new Date().toISOString().split('T')[0]);
       }
   });
</script>